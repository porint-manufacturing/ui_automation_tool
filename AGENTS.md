# AGENTS.md - AI エージェントとの協働ルール

このドキュメントは、AIエージェントとの効率的な協働のための基本ルールを定義します。

## 基本原則

### 1. 言語

- **すべてのコミュニケーションは日本語で行う**
- コード内のコメントも日本語で記述
- ドキュメント、レポート、サマリーも日本語で生成
- 例外: コード自体（変数名、関数名など）は英語

### 2. テスト実行とレポート

#### 必須ルール

- **テストを実行した場合、必ずテスト結果サマリーを生成する**
- サマリーは `docs/test_spec.md` で定義されたフォーマットに従う
- ファイル名: `reports/test_results/test_results_summary_YYYYMMDD_HHMM.md`
- タイムスタンプは実行時刻を使用

#### サマリーに含めるべき内容

1. **各テストの詳細結果**
   - テスト目的
   - 期待される結果
   - 実際の結果
   - 検証結果
2. **根拠の明示**
   - 「完了した」だけでなく、何をどう確認したかを明記
   - テストログの具体的な内容を引用
   - 数値データ（実行時間、行数など）を含める

3. **影響分析**
   - 変更内容のサマリー
   - コードメトリクス（行数、削減率など）
   - リグレッションの有無

### 3. 作業の進め方

#### 段階的アプローチ

- 大きなタスクは小さなステップに分割する
- 各ステップ後にテストを実行して検証する
- 問題が発生した場合は即座に報告し、対処方法を相談する

#### 勝手な判断の禁止

- **ユーザーの明示的な承認なしに作業を中断しない**
- 「区切る」「一旦終了する」などの判断は必ずユーザーに確認
- 困難に直面した場合は、代替案を提示して判断を仰ぐ

### 4. コミット

#### コミットメッセージ

- 英語で記述（Git標準に従う）
- Conventional Commits形式を使用
  - `feat:` 新機能
  - `fix:` バグ修正
  - `refactor:` リファクタリング
  - `test:` テスト追加・修正
  - `docs:` ドキュメント更新

#### コミット前の確認

- 必ずテストを実行
- テスト結果サマリーを生成
- ユーザーに承認を求める（`SafeToAutoRun: false`）

### 5. ドキュメント

#### 必須ドキュメント

- `task.md`: タスクチェックリスト（進捗管理）
- `implementation_plan.md`: 実装計画（PLANNING時）
- `walkthrough.md`: 作業内容の説明（VERIFICATION後）
- テスト結果サマリー（テスト実行時）

#### ドキュメントの更新

- 作業の進捗に合わせて `task.md` を更新
- 完了時に `walkthrough.md` を作成
- すべて日本語で記述

### 6. エラー処理

#### エラー発生時

1. エラー内容を正確に報告
2. 原因を分析
3. 複数の対処方法を提示
4. ユーザーの判断を仰ぐ

#### リカバリー

- `git checkout` などでクリーンな状態に戻す
- より小さなステップに分割して再試行
- 必要に応じてアプローチを変更

### 7. コードの品質

#### リファクタリング

- 段階的に実施（一度に大きな変更をしない）
- 各ステップでテストを実行
- リグレッションが発生しないことを確認

#### テスト

- 既存のテストを必ず実行
- 新機能には新しいテストを追加
- テストカバレッジを維持・向上

## プロジェクト固有のルール

### test_spec.md の遵守

- テスト仕様は `docs/test_spec.md` に従う
- **テスト結果サマリーは test_spec.md 4.3節のフォーマットを厳守**
- **テスト結果サマリーはローカルのみ（コミット・プッシュ不要）**
- 新しいテストを追加する場合は `test_spec.md` も更新

## テスト実行に関するルール

### テスト実行の原則

1. **リファクタリング時のテスト実行**
   - コードを移植・変更した場合、影響を受ける可能性のある**すべての関連テスト**を実行すること
   - 「リファクタリングの対象外」という理由でテストをスキップすることは原則として認められない
   - コードを移植した場合、そのコードが使用される全ての機能のテストを実行すべき

2. **テストをスキップする正当な理由**
   以下の理由のみがテストスキップの正当な理由として認められる：
   - **技術的制約**: UI操作が必要で自動化できない、特定のハードウェアが必要など
   - **環境制約**: 対話モードが必要、特定の外部システムへのアクセスが必要など
   - **時間制約**: ユーザーが明示的に時間制約を指定した場合のみ
   - **依存関係**: 実行に必要な前提条件が満たされていない場合

3. **テストスキップの説明責任**
   - テストをスキップする場合、その理由を**客観的かつ具体的**に説明すること
   - 「対象外」「関係ない」などの曖昧な理由は不可
   - 各スキップしたテストについて、なぜそのテストが実行できないのか、または実行する必要がないのかを明確に説明すること

### 成果物の自己レビュー

1. **生成前の自己レビュー義務**
   - すべての成果物（レポート、ドキュメント、コード等）は、ユーザーに提示する前に**必ず自己レビュー**を行うこと
   - 特にテスト結果サマリーやレポートは、内容の合理性を確認すること

2. **自己レビューのチェックポイント**
   - **論理的整合性**: 説明が論理的に一貫しているか
   - **客観性**: 主張が客観的事実に基づいているか
   - **完全性**: 必要な情報がすべて含まれているか
   - **正確性**: 記載内容が正確か（特に数値、日時、ファイル名等）
   - **合理性**: 結論や判断が合理的か

3. **前回の成果物のコピー禁止**
   - 前回のレポートやドキュメントをコピーして使い回すことは**厳禁**
   - 各成果物は、その時点での実際の状況を正確に反映すること
   - テンプレートとして参照することは可だが、内容は必ず現状に合わせて作成すること

## AGENTS.mdの更新ルール

- ユーザーから新しいルールの追加を指示された場合、このファイルに追記すること
- 追記後は必ずコミット＆プッシュすること
- プロジェクト固有でないルールは「基本原則」セクションに追加
- プロジェクト固有のルールは「プロジェクト固有のルール」セクションに追加

### ディレクトリ構造

```
automation/
├── automator.py          # メインスクリプト
├── inspector.py          # UI要素検査ツール
├── src/                  # モジュール化されたコード
│   ├── automator/
│   │   ├── core/        # コア機能
│   │   └── utils/       # ユーティリティ
│   ├── inspector/
│   └── shared/          # 共有モジュール
├── tests/               # テストスクリプト
├── docs/                # ドキュメント
└── reports/             # レポート出力
    └── test_results/    # テスト結果サマリー
```

## まとめ

- **日本語でコミュニケーション**
- **テスト実行後は必ずサマリー生成**
- **根拠を明示した報告**
- **段階的アプローチ**
- **勝手に判断しない**

これらのルールに従うことで、効率的で透明性の高い協働が可能になります。
